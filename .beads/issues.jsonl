{"id":"ws-4w8","title":"test issue ignore","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T10:08:13.834859885-05:00","updated_at":"2026-01-02T12:11:22.950478017-05:00","closed_at":"2026-01-02T12:11:22.950478017-05:00","close_reason":"Test issue - closing as requested by title"}
{"id":"ws-qmw","title":"Offline fuzzy + adjacency rewriting","description":"Implement an offline-only, deterministic detection + rewriting layer that improves WorkSafe's handling of negative language beyond explicit profanity. Scope includes adjacency (windowed) analysis, clause/sentence rewrites, excluded zones (quoted threads, fenced code), protected tokens (URLs/@handles/#channels), multi-sentence attack collapsing, and an opt-in sarcasm mode.\\n\\nPrimary code area: src/lib/detector.ts + src/lib/replacer.ts (dictionary mode).\\nPlan reference: IMPLEMENTATION_PLAN.md","acceptance_criteria":"A set of child tasks exists with explicit prerequisites and testable acceptance criteria.\\n\\nEnd state (when all children are complete): bun run test passes; dictionary mode remains 100% offline; negative language rewrites are deterministic and do not modify quoted email threads, code blocks (except comment lines), or URLs/@handles/#channels.","status":"in_progress","priority":1,"issue_type":"epic","assignee":"Sisyphus","estimated_minutes":480,"created_at":"2026-01-02T10:18:09.339517522-05:00","updated_at":"2026-01-02T12:03:33.445829507-05:00"}
{"id":"ws-qmw.1","title":"M0: Add table-driven corpus harness","description":"Create a reusable, table-driven test harness for validating dictionary-mode transformations. The goal is to make future adjacency/fuzzy work easy to validate deterministically.\\n\\nImplementation guidance:\\n- Prefer adding helpers inside existing test files (avoid extra files unless necessary).\\n- Create a small helper like runCase({name,input,expectedContains,expectedNotContains,expectedExact?}) that calls transformText() and asserts output.\\n- Keep cases human-readable and focused (one behavior per case).\\n\\nSuggested files:\\n- src/lib/replacer.test.ts (best place: integration-style transformText tests)\\n\\n","acceptance_criteria":"- Add a table-driven helper and at least 5 new baseline cases that reflect existing behavior (profanity/insults/phrase replacements).\\n- All tests pass: bun test src/lib/replacer.test.ts\\n- The new harness is used by the added cases (not dead code).","status":"closed","priority":1,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":60,"created_at":"2026-01-02T10:20:35.132338521-05:00","updated_at":"2026-01-02T11:11:06.932287065-05:00","closed_at":"2026-01-02T11:11:06.932287065-05:00","close_reason":"Completed: Table-driven test harness implemented with 5 baseline cases. All tests pass.","labels":["offline","rewrite","tests"],"dependencies":[{"issue_id":"ws-qmw.1","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:20:35.133889678-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.10","title":"M5: Add sarcasm opt-in setting (persisted locally)","description":"Add a user-facing opt-in toggle for sarcasm handling.\n\nRequirements:\n- Default OFF.\n- Persist locally (localStorage) and read on app init.\n- Only affects dictionary-mode rewriting (offline).\n\nImplementation notes:\n- This touches state + settings UI.\n- Keep visual changes minimal; focus is on functionality and wiring.","acceptance_criteria":"- Toggle exists and persists across reload.\n- Add an automated test if feasible (prefer e2e happy-path style), otherwise add a focused unit test around state persistence.\n- Manual validation: enable sarcasm, reload page, setting remains enabled.","status":"open","priority":3,"issue_type":"feature","estimated_minutes":120,"created_at":"2026-01-02T10:26:30.451982598-05:00","updated_at":"2026-01-02T10:26:30.451982598-05:00","labels":["offline","rewrite","ui"],"dependencies":[{"issue_id":"ws-qmw.10","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:26:30.453437866-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.10","depends_on_id":"ws-qmw.8","type":"blocks","created_at":"2026-01-02T10:29:41.39577014-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.11","title":"M5: Sarcasm heuristics gated by opt-in","description":"Implement conservative sarcasm heuristics that only run when the opt-in setting is enabled.\n\nGuidelines:\n- Use a small curated phrase list + punctuation cues.\n- Keep false positives low; do not rewrite praise/neutral statements unless confidence is high.\n- Do not rewrite in excluded zones or inside protected tokens.\n\nIntegration:\n- When sarcasm is detected, prefer a clause rewrite that softens tone but keeps meaning.","acceptance_criteria":"- Add tests for sarcasm behavior with toggle OFF (no rewrite) and ON (rewrite).\n- Add at least 2 negative tests where non-sarcastic text is not modified even when toggle ON.\n- Run: bun test src/lib/replacer.test.ts","status":"open","priority":3,"issue_type":"task","estimated_minutes":180,"created_at":"2026-01-02T10:27:31.7331554-05:00","updated_at":"2026-01-02T10:27:31.7331554-05:00","labels":["offline","rewrite"],"dependencies":[{"issue_id":"ws-qmw.11","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:27:31.734011197-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.11","depends_on_id":"ws-qmw.10","type":"blocks","created_at":"2026-01-02T10:29:41.432002331-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.12","title":"M6: Regression suite + tooling checks","description":"Final hardening task.\n\nRequirements:\n- Ensure all new behaviors are covered by tests (excluded zones, protected tokens, clause rewrites, adjacency).\n- Add at least one performance sanity check or test (e.g., very long input does not time out).\n- Run the standard toolchain checks and record any failures.\n\nNote: Do not fix unrelated pre-existing failures as part of this bead; only issues introduced by this work.","acceptance_criteria":"- bun run test passes\n- bun run typecheck passes\n- bun run lint passes (or issues are documented if they were pre-existing)\n","status":"open","priority":2,"issue_type":"chore","estimated_minutes":60,"created_at":"2026-01-02T10:28:31.696954294-05:00","updated_at":"2026-01-02T10:28:31.696954294-05:00","labels":["offline","rewrite","tests"],"dependencies":[{"issue_id":"ws-qmw.12","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:28:31.697838408-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.12","depends_on_id":"ws-qmw.11","type":"blocks","created_at":"2026-01-02T10:29:41.462755587-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.12","depends_on_id":"ws-qmw.8","type":"blocks","created_at":"2026-01-02T10:29:41.500764725-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.2","title":"M1: Implement excluded-zone masking (quotes + fenced code)","description":"Implement text zoning so WorkSafe does NOT rewrite content in:\n- Quoted email thread lines starting with \"\u003e\"\n- Fenced code blocks delimited by triple backticks\n\nException: inside fenced code blocks, lines that are code comments (leading \"#\", \"//\" or \"/*\") remain eligible for rewriting.\n\nRecommended approach (deterministic + keeps indices stable):\n- Produce a same-length \"masked text\" string for matching.\n  - Eligible characters remain unchanged\n  - Ineligible regions are replaced with spaces so indices align 1:1 with original text\n- Run existing detection (obscenity + word + phrase regex) against masked text.\n- When creating Detection objects, slice originals/replacements from the ORIGINAL text using start/end indices (which still align).\n\nDo not change output formatting yet; just prevent detections in excluded zones.\n\nSuggested code location:\n- src/lib/detector.ts (helper functions near detectIssues) or a small new src/lib/text-zones.ts if it stays internal.","acceptance_criteria":"- Add tests demonstrating:\n  - Lines starting with \"\u003e\" are never modified\n  - Fenced code is never modified\n  - Comment lines inside fenced code ARE eligible (#, //, /*)\n- Existing tests still pass.\n- Run: bun test src/lib/detector.test.ts","status":"closed","priority":0,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":120,"created_at":"2026-01-02T10:21:00.385120413-05:00","updated_at":"2026-01-02T11:37:40.867608075-05:00","closed_at":"2026-01-02T11:37:40.867608075-05:00","close_reason":"Completed: Fixed bug where word detection only checked insultReplacements instead of allWordReplacements, causing profanity like 'damn' to be missed. Changed line 165 to use allWordReplacements and added getWordType call. All tests passing.","labels":["offline","rewrite"],"dependencies":[{"issue_id":"ws-qmw.2","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:21:00.386648129-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.2","depends_on_id":"ws-qmw.1","type":"blocks","created_at":"2026-01-02T10:29:41.104442385-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.3","title":"M1: Protect URLs, @handles, and #channels from modifications","description":"Ensure WorkSafe never modifies URLs, @handles, or #channels. This applies to all detection/rewrite layers.\n\nDefinitions:\n- URL: match common http/https forms (keep simple, deterministic)\n- Handle: token starting with @ followed by allowed username characters\n- Channel: token starting with # followed by allowed channel characters\n\nRecommended approach:\n- Extend the masked-text strategy so protected tokens are masked for matching (prevent detections inside them).\n- Treat protected tokens as barriers: adjacency rules and sentence grouping must not match across them.\n\nImportant:\n- The output must preserve these tokens exactly.\n- Add negative tests for profanity inside a URL path.","acceptance_criteria":"- Add tests showing profanity/insult adjacent to a URL/handle/channel is handled without modifying the protected token.\n- Add tests showing profanity inside a URL path is not modified.\n- Run: bun test src/lib/replacer.test.ts","status":"closed","priority":0,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":90,"created_at":"2026-01-02T10:21:08.719927478-05:00","updated_at":"2026-01-02T11:41:26.446416394-05:00","closed_at":"2026-01-02T11:41:26.446416394-05:00","close_reason":"Completed: Added protection for URLs, @handles, and #channels. All tests passing.","labels":["offline","rewrite"],"dependencies":[{"issue_id":"ws-qmw.3","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:21:08.720497375-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.3","depends_on_id":"ws-qmw.2","type":"blocks","created_at":"2026-01-02T10:29:41.140083731-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.4","title":"M2: Sentence segmentation helper (eligible text only)","description":"Add a deterministic sentence segmentation helper that operates only on eligible (non-masked) text.\n\nConstraints:\n- Split sentences on . ! ? and newlines.\n- Must not produce sentence spans that cross excluded zones (quoted lines, fenced code).\n- Must treat protected tokens (URLs/@handles/#channels) as atomic (do not split inside them).\n\nDeliverable should be a pure function that returns an array of spans {startIndex,endIndex} into the original text.\n\nThe goal is to enable clause/sentence rewrites and multi-sentence collapsing without regexing the entire raw string.","acceptance_criteria":"- Add unit tests for the segmentation helper with mixed content (normal text + quoted thread + code fence + URL).\n- Run: bun test src/lib/detector.test.ts (or a new focused test file if needed).\n- Existing tests remain passing.","status":"closed","priority":1,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":90,"created_at":"2026-01-02T10:21:17.269752887-05:00","updated_at":"2026-01-02T11:52:11.258946493-05:00","closed_at":"2026-01-02T11:52:11.258946493-05:00","close_reason":"Completed: Implemented segmentSentences function with comprehensive tests. All 28 tests passing.","labels":["offline","rewrite"],"dependencies":[{"issue_id":"ws-qmw.4","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:21:17.270215802-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.4","depends_on_id":"ws-qmw.3","type":"blocks","created_at":"2026-01-02T10:29:41.177189458-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.5","title":"M2: Add deterministic clause rewrite templates (direct attack + frustration)","description":"Implement an offline, deterministic rewrite layer that can rewrite whole sentence spans (or grouped spans) when strong negative intent is detected.\n\nScope (start simple):\n- Direct attack: 2nd-person target (you/your) + insult/competence term -\u003e rewrite to a behavior-focused, softened statement that retains the claim.\n- Frustration: this/that/it + is/was + negative descriptor -\u003e rewrite to a solution-oriented statement.\n\nAdditional constraints:\n- Identity-targeting slurs: rely on obscenity English dataset coverage; when detected in a direct attack, remove identity targeting in the rewrite while keeping intent.\n- Do not fire inside excluded zones.\n- Do not alter protected tokens (URLs/@handles/#channels). If a sentence span contains protected tokens, either:\n  (a) split the span around tokens and rewrite only eligible segments, or\n  (b) skip clause rewrite and fall back to existing word/phrase replacements.\n  Choose a deterministic approach and test it.\n\nIntegration expectations:\n- Clause rewrites should produce a single Detection-like replacement span and override smaller detections within that span (top-down).","acceptance_criteria":"- Add tests in src/lib/replacer.test.ts that assert whole-sentence rewriting occurs for direct attacks and frustration.\n- Add tests showing:\n  - protected tokens remain unchanged\n  - excluded zones are not rewritten\n- Run: bun test src/lib/replacer.test.ts","status":"closed","priority":1,"issue_type":"feature","assignee":"Sisyphus","estimated_minutes":180,"created_at":"2026-01-02T10:22:19.775584478-05:00","updated_at":"2026-01-02T12:41:44.567828392-05:00","closed_at":"2026-01-02T12:41:44.567828392-05:00","close_reason":"Completed: All 51 tests passing. Clause rewrite templates for direct attack (you/your + insult) and frustration (this/that/it + is/was + negative) fully implemented. Protected tokens and excluded zones properly respected.","labels":["offline","rewrite"],"dependencies":[{"issue_id":"ws-qmw.5","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:22:19.776694183-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.5","depends_on_id":"ws-qmw.4","type":"blocks","created_at":"2026-01-02T10:29:41.21444647-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.6","title":"M2: Collapse multi-sentence attacks into one softer paragraph","description":"When multiple consecutive sentences are flagged as negative (attack/frustration), collapse them into a single softer sentence/paragraph.\n\nRules:\n- Only collapse consecutive eligible sentences (do not cross excluded zones: quoted lines, fenced code).\n- Protected tokens (URLs/@handles/#channels) must be preserved; do not collapse across them unless they remain verbatim.\n- The replacement should keep the combined intent while softening tone.\n\nImplementation hint:\n- After sentence scoring, group consecutive rewrite-worthy sentence spans and replace the entire group with one replacement.","acceptance_criteria":"- Add tests where input has 2-3 consecutive negative sentences and output becomes a single combined rewrite.\n- Add tests showing grouping stops at:\n  - quoted lines\n  - code fences\n  - protected tokens\n- Run: bun test src/lib/replacer.test.ts","status":"closed","priority":1,"issue_type":"feature","assignee":"Sisyphus","estimated_minutes":120,"created_at":"2026-01-02T10:22:29.614387505-05:00","updated_at":"2026-01-02T13:04:03.092448648-05:00","closed_at":"2026-01-02T13:04:03.092448648-05:00","close_reason":"Completed M2 feature: collapse consecutive negative sentences","labels":["offline","rewrite"],"dependencies":[{"issue_id":"ws-qmw.6","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:22:29.615224197-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.6","depends_on_id":"ws-qmw.5","type":"blocks","created_at":"2026-01-02T10:29:41.252036243-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.7","title":"M3: Token-based adjacency rule engine (window scoring)","description":"Implement adjacency (windowed) analysis for negative intent. This increases recall beyond exact phrases.\n\nRequirements:\n- Tokenization returns tokens with raw, normalized, startIndex/endIndex.\n- Implement a sliding window (default 6 tokens) to compute a deterministic score for rules like:\n  - you/your near insult/competence term\n  - this/that/it near is/was near negative descriptor\n- Score is distance-weighted and deterministic.\n- Protected tokens (URL/@/#) are barriers: do not match across them; never include them inside rewritten spans.\n- Excluded zones are omitted entirely from analysis.\n\nIntegration:\n- Only trigger clause rewrites when score \u003e= threshold; otherwise fall back to existing exact replacements.","acceptance_criteria":"- Add focused unit tests for tokenization + adjacency scoring (pure functions).\n- Add at least 3 integration tests showing adjacency triggers clause rewrite even when no exact phrase regex exists.\n- Run: bun test src/lib/replacer.test.ts","status":"closed","priority":2,"issue_type":"feature","assignee":"sisyphus","estimated_minutes":180,"created_at":"2026-01-02T10:23:29.634902973-05:00","updated_at":"2026-01-02T13:11:40.442943876-05:00","closed_at":"2026-01-02T13:11:40.442943876-05:00","close_reason":"Completed: Implemented token-based adjacency rule engine with sliding window analysis, distance-weighted scoring, and protected token barriers. Added 23 comprehensive tests covering tokenization, adjacency scoring, and integration. All tests passing with no type errors or lint warnings.","labels":["offline","rewrite"],"dependencies":[{"issue_id":"ws-qmw.7","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:23:29.635395263-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.7","depends_on_id":"ws-qmw.6","type":"blocks","created_at":"2026-01-02T10:29:41.289009582-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.8","title":"M3: Passive-aggressive adjacency cues (beyond exact regex list)","description":"Extend detection for passive-aggressive language beyond the static regex phrase list by adding adjacency cues.\n\nImplement a small deterministic subset:\n- \"just\" near \"checking\" near \"in\" (allow small gaps)\n- \"per\" near \"my\" near \"last\" near \"email\" (allow small gaps)\n- \"friendly\" near \"reminder\" (allow small gaps)\n\nConstraints:\n- Must not trigger in quoted threads or fenced code.\n- Must not modify URLs/@handles/#channels.\n\nIntegration:\n- When cues are detected above threshold, prefer a clause rewrite OR reuse existing phrase replacements, depending on your precedence rules.\n- Keep results deterministic.","acceptance_criteria":"- Add tests where passive-aggressive is obfuscated by extra punctuation/words and still gets rewritten.\n- Ensure existing phrase-regex behavior remains intact.\n- Run: bun test src/lib/replacer.test.ts","status":"in_progress","priority":2,"issue_type":"task","assignee":"Sisyphus","estimated_minutes":120,"created_at":"2026-01-02T10:24:29.877994133-05:00","updated_at":"2026-01-02T13:12:53.287152729-05:00","labels":["offline","rewrite"],"dependencies":[{"issue_id":"ws-qmw.8","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:24:29.878539695-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.8","depends_on_id":"ws-qmw.7","type":"blocks","created_at":"2026-01-02T10:29:41.32465311-05:00","created_by":"daemon"}]}
{"id":"ws-qmw.9","title":"M4 (optional): Constrained fuzzy matching for edge cases","description":"Optional: add a very constrained fuzzy matching fallback for a small curated set of high-impact terms.\n\nHard constraints:\n- Must not increase false positives (never match inside longer safe words).\n- Only apply when token normalization and adjacency rules failed.\n- Keep deterministic and offline.\n\nSuggested implementation:\n- Phonetic matching OR tiny edit-distance against a short list.\n- Gate behind a constant so it can be disabled easily.","acceptance_criteria":"- Add tests demonstrating at least 2 edge cases that are now detected and rewritten.\n- Add at least 2 negative tests demonstrating safe words are not matched.\n- Run: bun test src/lib/detector.test.ts","status":"open","priority":3,"issue_type":"task","estimated_minutes":120,"created_at":"2026-01-02T10:25:29.843298205-05:00","updated_at":"2026-01-02T10:25:29.843298205-05:00","labels":["offline","rewrite"],"dependencies":[{"issue_id":"ws-qmw.9","depends_on_id":"ws-qmw","type":"parent-child","created_at":"2026-01-02T10:25:29.852831602-05:00","created_by":"daemon"},{"issue_id":"ws-qmw.9","depends_on_id":"ws-qmw.8","type":"blocks","created_at":"2026-01-02T10:29:41.360851885-05:00","created_by":"daemon"}]}
